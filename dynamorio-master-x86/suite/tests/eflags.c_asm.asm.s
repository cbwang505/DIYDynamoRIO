








































































































































































































































































































































































   

























































  



  





















   




  



































































































































































































































































































































































































































































































































































































































































































































































































.686 
.XMM 
.MODEL flat, c 
ASSUME fs:_DATA 
.CODE

EXTERN test_flag:PROC


        test_eflags_pos PROC

        
        mov      ecx, dword ptr [ 1*4 + esp]
        push     ecx 
         
 push ecx 
 call set_flag 
 lea esp, [4*1 + esp]
        mov      ecx, dword ptr [esp]
        pushfd
        pop      eax
        
        push     0
        popfd
         
 push 1 
 push ecx 
 push eax 
 call test_flag 
 lea esp, [4*3 + esp]

        mov      ecx, dword ptr [esp]
         
 push ecx 
 call clear_flag 
 lea esp, [4*1 + esp]
        mov      ecx, dword ptr [esp]
        pushfd
        pop      eax
        
        push     0
        popfd
         
 push 0 
 push ecx 
 push eax 
 call test_flag 
 lea esp, [4*3 + esp]

        pop      ecx 
        ret
        test_eflags_pos ENDP

    


        set_flag PROC

        
        pushfd
        pop      eax
        mov      ecx, dword ptr [ 1*4 + esp]
        mov      edx, 1
        shl      edx, cl
        or       eax, edx
        push     eax
        popfd
        ret
        set_flag ENDP

    


        clear_flag PROC

        
        pushfd
        pop      eax
        mov      ecx, dword ptr [ 1*4 + esp]
        mov      edx, 1
        shl      edx, cl
        not      edx
        and      eax, edx
        push     eax
        popfd
        ret
        clear_flag ENDP

END


